{
    "collab_server" : "",
    "contents" : "# data is from http://www.bea.gov/regional/downloadzip.cfm\n\n# packages used\nlibrary(readr)\nlibrary(tidyr)\nlibrary(dplyr)\nlibrary(ggplot2)\n\n\npce <- read_csv(\"state per capita expenditures.csv\")\npci <- read_csv(\"state per capita income.csv\")\n\n######################\n# U.S. level savings #\n######################\n# create tidy national-level expenditures\npce_us <- pce %>%\n  filter(Description == \"Personal consumption expenditures\",\n         GeoName == \"United States\") %>%\n  gather(Year, Expenditures, `1997`:`2014`) %>%\n  select(Year, Expenditures)\n\n# create tidy state-level incomes\npci_us <- pci %>%\n  filter(Description == \"Per capita personal income (dollars) 2/\",\n         GeoName == \"United States\") %>%\n  gather(Year, Income, `1997`:`2015`) %>%\n  select(Year, Income)\n\n# join income and expenditure data and calculate savings\nsavings_us <- pce_us %>% \n  left_join(pci_us) %>%\n  mutate(Savings = Income - Expenditures,\n         Savings_Rate = Savings / Income)\n\n# visualize savings rate from 1997-2014\nggplot(savings_us, aes(Year, Savings_Rate, group = 1)) +\n  geom_line() +\n  scale_y_continuous(labels = scales::percent, limits = c(0, .23))\n\n\n#######################\n# state level savings #\n#######################\n# create tidy state-level expenditures\npce_state <- pce %>%\n  slice(25:1248) %>%\n  filter(Description == \"Personal consumption expenditures\") %>%\n  gather(Year, Expenditures, `1997`:`2014`) %>%\n  select(GeoName, Year, Expenditures)\n\n# create tidy state-level incomes\npci_state <- pci %>%\n  slice(4:156) %>%\n  filter(Description == \"Per capita personal income (dollars) 2/\") %>%\n  gather(Year, Income, `1997`:`2014`) %>%\n  select(GeoName, Year, Income)\n\n# create tidy state-level savings\nsavings_state <- pce_state %>%\n  left_join(pci_state) %>%\n  mutate(Savings = Income - Expenditures,\n         Savings_Rate = Savings / Income, \n         Year = as.numeric(Year)) %>%\n  filter(GeoName != \"District of Columbia\")\n\n# top 10 savers in 2014\nsavings_state %>% \n  filter(Year == 2014) %>% \n  arrange(desc(Savings_Rate))\n\n# bottom 10 savers in 2014\nsavings_state %>% \n  filter(Year == 2014) %>% \n  arrange(Savings_Rate)\n\n# top 10 average savers (1997-2014)\nsavings_state %>%\n  group_by(GeoName) %>%\n  summarise(Avg_Rate = mean(Savings_Rate)) %>%\n  arrange(desc(Avg_Rate))\n\n# bottom 10 average savers (1997-2014)\nsavings_state %>%\n  group_by(GeoName) %>%\n  summarise(Avg_Rate = mean(Savings_Rate)) %>%\n  arrange(Avg_Rate)\n\n# color by positive vs negative trend\nsavings_state <- savings_state %>% \n  group_by(GeoName) %>% \n  slice(c(1, 18)) %>% \n  select(GeoName, Year, Savings_Rate) %>% \n  spread(Year, Savings_Rate) %>% \n  mutate(Change = ifelse(`1997` < `2014`, \"Positive\", \"Negative\")) %>% \n  select(GeoName, Change) %>%\n  right_join(savings_state)\n\nggplot(savings_state, aes(Year, Savings_Rate)) +\n  geom_line(aes(group = GeoName, color = Change)) +\n  facet_wrap(~ GeoName, ncol = 5) +\n  scale_x_continuous(breaks = c(1997, 2014)) +\n  scale_y_continuous(labels = scales::percent, breaks = c(0, .3)) +\n  xlab(NULL) +\n  ylab(NULL) +\n  theme_bw() \n\n# need to figure out how to add background lines to each facet\n\n\n# rank-order by savings rate growth since 1997\nsavings_state %>% \n  group_by(GeoName) %>% \n  slice(c(1, 18)) %>% \n  select(GeoName, Year, Savings_Rate) %>% \n  spread(Year, Savings_Rate) %>% \n  mutate(Diff = `2014` - `1997`, \n         Change = ifelse(`1997` < `2014`, \"Positive\", \"Negative\")) %>% \n  arrange(Diff)\n\n\n# t-test for differences in savings rate for positive vs. negative trend states\nt.test(Savings_Rate ~ Change, data = (savings_state))\nwilcox.test(Savings_Rate ~ Change, data = (savings_state))\n\n\n# so the next question is, what's driving the difference between the high and \n# low savers? We can first check if there is a difference between the incomes and\n# consumption of the increasing states (15 states) versus decreasing states (35)\n\n# create percent \npce_us <- pce %>%\n  slice(1) %>%\n  gather(Year, US_Expenditures, `1997`:`2014`) %>%\n  select(Year, US_Expenditures) %>%\n  mutate(Year = as.numeric(Year))\n\npci_us <- pci %>%\n  slice(3) %>%\n  gather(Year, US_Income, `1997`:`2014`) %>%\n  select(Year, US_Income) %>%\n  mutate(Year = as.numeric(Year))\n\npcts <- savings_state %>%\n  left_join(pce_us, by = \"Year\") %>%\n  left_join(pci_us, by = \"Year\") %>%\n  mutate(Exp_Pct = Expenditures / US_Expenditures,\n         Inc_Pct = Income / US_Income) %>%\n  select(-c(Expenditures:Savings_Rate))\n\n# t-test shows their is a difference between expenses but not incomes\nt.test(Inc_Pct ~ Change, data = pcts)\n\nggplot(pcts, aes(Change, Exp_Pct)) +\n  geom_boxplot() +\n  geom_jitter()\n\n",
    "created" : 1474073444624.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2989749435",
    "id" : "12468DDF",
    "lastKnownWriteTime" : 1474081006,
    "last_content_update" : 1474081006228,
    "path" : "~/Dropbox/Academia/Digital Projects/Savers in the US/U.S.-Income-vs-Consumption/01-data-prep.R",
    "project_path" : "01-data-prep.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}