data_clean %>%
filter(Location == "United States") %>%
ggplot(aes(x = Year)) +
geom_line(aes(y = Income, group = 1), color = "darkseagreen4") +
geom_line(aes(y = Expenditures, group = 1), color = "firebrick3") +
geom_ribbon(aes(ymin = Expenditures, ymax = Income, group = 1), fill = "darkseagreen1", alpha = .5)
str(data_clean)
mutate(data_clean, Year = as.numeric(Year))
data_clean <- mutate(data_clean, Year = as.numeric(Year))
data_clean %>%
filter(Location == "United States") %>%
ggplot(aes(x = Year)) +
geom_line(aes(y = Income, group = 1), color = "darkseagreen4") +
geom_line(aes(y = Expenditures, group = 1), color = "firebrick3") +
geom_ribbon(aes(ymin = Expenditures, ymax = Income, group = 1), fill = "darkseagreen1", alpha = .5) +
annotate("text", x = 2006, y = 37500, label = "per capita disposable income", color = "darkseagreen4") +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
ggplot(aes(x = Year)) +
geom_line(aes(y = Income, group = 1), color = "darkseagreen4") +
geom_line(aes(y = Expenditures, group = 1), color = "firebrick3") +
geom_ribbon(aes(ymin = Expenditures, ymax = Income, group = 1), fill = "darkseagreen1", alpha = .5) +
annotate("text", x = 2006, y = 37500, label = "per capita disposable income", color = "darkseagreen4") +
annotate("text", x = 2006, y = 30000, label = "per capita expenditures", color = "firebrick3") +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
ggplot(aes(x = Year)) +
geom_line(aes(y = Income, group = 1), color = "darkseagreen4") +
geom_line(aes(y = Expenditures, group = 1), color = "firebrick3") +
geom_ribbon(aes(ymin = Expenditures, ymax = Income, group = 1), fill = "darkseagreen1", alpha = .5) +
annotate("text", x = 2006, y = 37500, label = "per capita disposable income", color = "darkseagreen4") +
annotate("text", x = 2006, y = 30000, label = "per capita expenditures", color = "firebrick3", hjust = 0) +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
ggplot(aes(x = Year)) +
geom_line(aes(y = Income, group = 1), color = "darkseagreen4") +
geom_line(aes(y = Expenditures, group = 1), color = "firebrick3") +
geom_ribbon(aes(ymin = Expenditures, ymax = Income, group = 1), fill = "darkseagreen1", alpha = .5) +
annotate("text", x = 2006, y = 37500, label = "per capita disposable income", color = "darkseagreen4", hjust = 0) +
annotate("text", x = 2006, y = 30000, label = "per capita expenditures", color = "firebrick3", hjust = 0) +
theme_minimal()
data_clean %>%
filter(Location == "United States")
(40471-22536) / 22536
(37196 - 20384) / 20384
(3275 - 2152) / 2152
data_clean %>%
filter(Location == "United States") %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .23))
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .23))
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .15))
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .12))
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
scale_y_continuous(labels = scales::percent)
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .11))
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .12))
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .115))
40471 - 37196
40471 - (3275/2)
data_clean %>%
filter(Location == "United States") %>%
ggplot(aes(x = Year)) +
geom_line(aes(y = Income, group = 1), color = "darkseagreen4") +
geom_line(aes(y = Expenditures, group = 1), color = "firebrick3") +
geom_ribbon(aes(ymin = Expenditures, ymax = Income, group = 1), fill = "darkseagreen1", alpha = .5) +
annotate("text", x = 2014, y = 40471, label = "2014 PCI: $40.5K", color = "darkseagreen4", hjust = 0) +
annotate("text", x = 2014, y = 37196, label = "2014 PCE: $37.2K", color = "firebrick3", hjust = 0) +
annotate("text", x = 2014, y = 38833.5, label = "2014 Savings: $3.3K", color = "darkseagreen1", hjust = 0) +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
ggplot(aes(x = Year)) +
geom_line(aes(y = Income, group = 1), color = "darkseagreen4") +
geom_line(aes(y = Expenditures, group = 1), color = "firebrick3") +
geom_ribbon(aes(ymin = Expenditures, ymax = Income, group = 1), fill = "darkseagreen1", alpha = .5) +
annotate("text", x = 2014.25, y = 40471, label = "2014 PCI: $40.5K", color = "darkseagreen4", hjust = 0) +
annotate("text", x = 2014.25, y = 37196, label = "2014 PCE: $37.2K", color = "firebrick3", hjust = 0) +
annotate("text", x = 2014.25, y = 38833.5, label = "2014 Savings: $3.3K", color = "darkseagreen1", hjust = 0) +
scale_x_continuous(limits = c(1997, 2016)) +
scale_y_continuous("Current Year Dollars", scales::dollar) +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
ggplot(aes(x = Year)) +
geom_line(aes(y = Income, group = 1), color = "darkseagreen4") +
geom_line(aes(y = Expenditures, group = 1), color = "firebrick3") +
geom_ribbon(aes(ymin = Expenditures, ymax = Income, group = 1), fill = "darkseagreen1", alpha = .5) +
annotate("text", x = 2014.25, y = 40471, label = "2014 PCI: $40.5K", color = "darkseagreen4", hjust = 0) +
annotate("text", x = 2014.25, y = 37196, label = "2014 PCE: $37.2K", color = "firebrick3", hjust = 0) +
annotate("text", x = 2014.25, y = 38833.5, label = "2014 Savings: $3.3K", color = "darkseagreen1", hjust = 0) +
scale_x_continuous(limits = c(1997, 2016))
data_clean %>%
filter(Location == "United States") %>%
ggplot(aes(x = Year)) +
geom_line(aes(y = Income, group = 1), color = "darkseagreen4") +
geom_line(aes(y = Expenditures, group = 1), color = "firebrick3") +
geom_ribbon(aes(ymin = Expenditures, ymax = Income, group = 1), fill = "darkseagreen1", alpha = .5) +
annotate("text", x = 2014.25, y = 40471, label = "2014 PCI: $40.5K", color = "darkseagreen4", hjust = 0) +
annotate("text", x = 2014.25, y = 37196, label = "2014 PCE: $37.2K", color = "firebrick3", hjust = 0) +
annotate("text", x = 2014.25, y = 38833.5, label = "2014 Savings: $3.3K", color = "darkseagreen1", hjust = 0) +
scale_x_continuous(limits = c(1997, 2016)) +
scale_y_continuous("Current Year Dollars", labels = scales::dollar) +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
ggplot(aes(x = Year)) +
geom_line(aes(y = Income, group = 1), color = "darkseagreen4") +
geom_line(aes(y = Expenditures, group = 1), color = "firebrick3") +
geom_ribbon(aes(ymin = Expenditures, ymax = Income, group = 1), fill = "darkseagreen1", alpha = .5) +
annotate("text", x = 2014.25, y = 40471, label = "2014 PCI: $40.5K", color = "darkseagreen4", hjust = 0) +
annotate("text", x = 2014.25, y = 37196, label = "2014 PCE: $37.2K", color = "firebrick3", hjust = 0) +
annotate("text", x = 2014.25, y = 38833.5, label = "2014 Savings: $3.3K", color = "darkseagreen2", hjust = 0) +
scale_x_continuous(limits = c(1997, 2016)) +
scale_y_continuous("Current Year Dollars", labels = scales::dollar) +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
ggplot(aes(x = Year)) +
geom_line(aes(y = Income, group = 1), color = "darkseagreen4") +
geom_line(aes(y = Expenditures, group = 1), color = "firebrick3") +
geom_ribbon(aes(ymin = Expenditures, ymax = Income, group = 1), fill = "darkseagreen1", alpha = .5) +
annotate("text", x = 2014.25, y = 40471, label = "2014 PCI: $40.5K", color = "darkseagreen4", hjust = 0) +
annotate("text", x = 2014.25, y = 37196, label = "2014 PCE: $37.2K", color = "firebrick3", hjust = 0) +
annotate("text", x = 2014.25, y = 38833.5, label = "2014 Savings: $3.3K", color = "darkseagreen2", hjust = 0) +
scale_x_continuous(NULL, limits = c(1997, 2016)) +
scale_y_continuous("Current Year Dollars", labels = scales::dollar) +
theme_minimal()
2014-1998
data_clean %>%
filter(Location == "United States") %>%
ggplot(aes(x = Year)) +
geom_line(aes(y = Income, group = 1), color = "darkseagreen4") +
geom_line(aes(y = Expenditures, group = 1), color = "firebrick3") +
geom_ribbon(aes(ymin = Expenditures, ymax = Income, group = 1), fill = "darkseagreen1", alpha = .5) +
annotate("text", x = 2014.25, y = 40471, label = "2014 PCI: $40.5K", color = "darkseagreen4", hjust = 0) +
annotate("text", x = 2014.25, y = 37196, label = "2014 PCE: $37.2K", color = "firebrick3", hjust = 0) +
annotate("text", x = 2014.25, y = 38833.5, label = "2014 Savings: $3.3K", color = "darkseagreen2", hjust = 0) +
scale_x_continuous(NULL, limits = c(1997, 2016), breaks = seq(1998, 2014, by = 4)) +
scale_y_continuous("Current Year Dollars", labels = scales::dollar) +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .115))
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income)
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
scale_y_continuous(NULL, labels = scales::percent, limits = c(0, .115)) +
ggtitle("National-level Savings Rate") +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
ggplot(aes(x = Year)) +
geom_line(aes(y = Income, group = 1), color = "darkseagreen4") +
geom_line(aes(y = Expenditures, group = 1), color = "firebrick3") +
geom_ribbon(aes(ymin = Expenditures, ymax = Income, group = 1), fill = "darkseagreen1", alpha = .5) +
annotate("text", x = 2014.25, y = 40471, label = "2014 PCI: $40.5K", color = "darkseagreen4", hjust = 0) +
annotate("text", x = 2014.25, y = 37196, label = "2014 PCE: $37.2K", color = "firebrick3", hjust = 0) +
annotate("text", x = 2014.25, y = 38833.5, label = "2014 Savings: $3.3K", color = "darkseagreen2", hjust = 0) +
scale_x_continuous(NULL, limits = c(1997, 2016), breaks = seq(1998, 2014, by = 4)) +
scale_y_continuous("Current Year Dollars", labels = scales::dollar) +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
scale_y_continuous(NULL, labels = scales::percent, limits = c(0, .115)) +
ggtitle("National-level Savings Rate") +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
mutate(PCI_YoY = (Income - lag(Income)) / lag(Income),
PCE_YoY = (Expenditures - lag(Expenditures)) / lag(Expenditures),
Sav_YoY = (Savings - lag(Savings)) / lag(Savings))
data_clean %>%
filter(Location == "United States") %>%
mutate(PCI_YoY = (Income - lag(Income)) / lag(Income),
PCE_YoY = (Expenditures - lag(Expenditures)) / lag(Expenditures),
Sav_YoY = (Savings - lag(Savings)) / lag(Savings)) %>%
ggplot(aes(Year)) +
geom_line(aes(y = PCI_YoY))
data_clean %>%
filter(Location == "United States") %>%
mutate(PCI_YoY = (Income - lag(Income)) / lag(Income),
PCE_YoY = (Expenditures - lag(Expenditures)) / lag(Expenditures),
Sav_YoY = (Savings - lag(Savings)) / lag(Savings)) %>%
ggplot(aes(Year)) +
geom_line(aes(y = PCI_YoY)) +
geom_line(aes(y = PCE_YoY)) +
geom_line(aes(y = Sav_YoY))
data_clean %>%
filter(Location == "United States") %>%
mutate(PCI_YoY = (Income - lag(Income)) / lag(Income),
PCE_YoY = (Expenditures - lag(Expenditures)) / lag(Expenditures),
Sav_YoY = (Savings - lag(Savings)) / lag(Savings)) %>%
select(Year, contains("YoY")) %>%
gather(Variable, Change, - Year) %>%
ggplot(aes(Year, Change, color = Variable)) +
geom_line()
data_clean %>%
filter(Location == "United States")
data_clean %>%
filter(Location == "United States") %>%
mutate(PCI_YoY = (Income - min(Income)) / min(Income),
PCE_YoY = (Expenditures - lag(Expenditures)) / lag(Expenditures),
Sav_YoY = (Savings - lag(Savings)) / lag(Savings))
data_clean %>%
filter(Location == "United States") %>%
mutate(PCI_YoY = (Income - Income[1]) / min(Income),
PCE_YoY = (Expenditures - lag(Expenditures)) / lag(Expenditures),
Sav_YoY = (Savings - lag(Savings)) / lag(Savings))
data_clean %>%
filter(Location == "United States") %>%
mutate(PCI_YoY = (Income - Income[1]) / Income[1],
PCE_YoY = (Expenditures - Expenditures[1]) / Expenditures[1],
Sav_YoY = (Savings - Savings[1]) / Savings[1])
data_clean %>%
filter(Location == "United States") %>%
mutate(PCI_YoY = (Income - Income[1]) / Income[1],
PCE_YoY = (Expenditures - Expenditures[1]) / Expenditures[1],
Sav_YoY = (Savings - Savings[1]) / Savings[1]) %>%
select(Year, contains("YoY")) %>%
gather(Variable, Change, - Year) %>%
ggplot(aes(Year, Change, color = Variable)) +
geom_line()
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
geom_hline(mean(.$Savings_Rate)) +
scale_y_continuous(NULL, labels = scales::percent, limits = c(0, .115)) +
ggtitle("National-level Savings Rate") +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
geom_hline(mean(data_clean$Savings_Rate)) +
scale_y_continuous(NULL, labels = scales::percent, limits = c(0, .115)) +
ggtitle("National-level Savings Rate") +
theme_minimal()
?geom_hline
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
geom_abline() +
scale_y_continuous(NULL, labels = scales::percent, limits = c(0, .115)) +
ggtitle("National-level Savings Rate") +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
stat_summary(fun.y = mean, geom="line") +
scale_y_continuous(NULL, labels = scales::percent, limits = c(0, .115)) +
ggtitle("National-level Savings Rate") +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
geom_hline(aes(yintercept = Savings_Rate) +
scale_y_continuous(NULL, labels = scales::percent, limits = c(0, .115)) +
ggtitle("National-level Savings Rate") +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
geom_hline(aes(yintercept = Savings_Rate)) +
scale_y_continuous(NULL, labels = scales::percent, limits = c(0, .115)) +
ggtitle("National-level Savings Rate") +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate, group = 1)) +
geom_line() +
geom_hline(yintercept = Savings_Rate) +
scale_y_continuous(NULL, labels = scales::percent, limits = c(0, .115)) +
ggtitle("National-level Savings Rate") +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate)) +
geom_line() +
geom_hline(aes(yintercept = Savings_Rate)) +
scale_y_continuous(NULL, labels = scales::percent, limits = c(0, .115)) +
ggtitle("National-level Savings Rate") +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate)) +
geom_line() +
geom_smooth(method = "lm", se = FALSE) +
scale_y_continuous(NULL, labels = scales::percent, limits = c(0, .115)) +
ggtitle("National-level Savings Rate") +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income)
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>% summarise(mean(Savings_Rate))
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate)) +
geom_line() +
geom_hline(aes(yintercept = mean(Savings_Rate, na.rm=T))) +
scale_y_continuous(NULL, labels = scales::percent, limits = c(0, .115)) +
ggtitle("National-level Savings Rate") +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate)) +
geom_line() +
geom_hline(aes(yintercept = mean(Savings_Rate), linetype = "dashed", alpha = .5)) +
scale_y_continuous(NULL, labels = scales::percent, limits = c(0, .115)) +
ggtitle("National-level Savings Rate") +
theme_minimal()
?linetype
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate)) +
geom_line() +
geom_hline(aes(yintercept = mean(Savings_Rate)), linetype = "dashed", alpha = .5) +
scale_y_continuous(NULL, labels = scales::percent, limits = c(0, .115)) +
ggtitle("National-level Savings Rate") +
theme_minimal()
data_clean %>%
+   filter(Location == "United States") %>%
+   mutate(Savings_Rate = Savings / Income) %>% summarise(min(Savings_Rate))
data_clean %>%
+   filter(Location == "United States") %>%
+   mutate(Savings_Rate = Savings / Income) %>% summarise(min(Savings_Rate))
data_clean %>%
+   filter(Location == "United States") %>%
+   mutate(Savings_Rate = Savings / Income) %>% summarise(min(Savings_Rate))
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>% summarise(min(Savings_Rate), max(Savings_Rate))
url_pci <- read_html("http://www.bea.gov/iTable/iTableHtml.cfm?reqid=70&step=30&isuri=1&7022=21&7023=0&7024=non-industry&7033=-1&7025=0&7026=00000,01000,02000,04000,05000,06000,08000,09000,10000,11000,12000,13000,15000,16000,17000,18000,19000,20000,21000,22000,23000,24000,25000,26000,27000,28000,29000,30000,31000,32000,33000,34000,35000,36000,37000,38000,39000,40000,41000,42000,44000,45000,46000,47000,48000,49000,50000,51000,53000,54000,55000,56000&7027=-1&7001=421&7028=53&7031=0&7040=-1&7083=levels&7029=23&7090=70")
library(rvest)        # scraping data
library(tidyr)        # creating tidy data
library(dplyr)        # transforming (joining, summarizing, etc.) data
library(tibble)       # coercing data to tibbles
library(magrittr)     # for piping capabilities
library(DT)           # for printing nice HTML output tables
library(ggplot2)
url_pci <- read_html("http://www.bea.gov/iTable/iTableHtml.cfm?reqid=70&step=30&isuri=1&7022=21&7023=0&7024=non-industry&7033=-1&7025=0&7026=00000,01000,02000,04000,05000,06000,08000,09000,10000,11000,12000,13000,15000,16000,17000,18000,19000,20000,21000,22000,23000,24000,25000,26000,27000,28000,29000,30000,31000,32000,33000,34000,35000,36000,37000,38000,39000,40000,41000,42000,44000,45000,46000,47000,48000,49000,50000,51000,53000,54000,55000,56000&7027=-1&7001=421&7028=53&7031=0&7040=-1&7083=levels&7029=23&7090=70")
pci_raw <- url_pci %>%
html_nodes("table") %>%
.[2] %>%
html_table(fill = TRUE) %>%
.[[1]]
url_pce <- read_html("http://www.bea.gov/iTable/iTableHtml.cfm?reqid=70&step=10&isuri=1&7003=2&7035=-1&7004=x&7005=1&7006=00000,01000,02000,04000,05000,06000,08000,09000,10000,11000,12000,13000,15000,16000,17000,18000,19000,20000,21000,22000,23000,24000,25000,26000,27000,28000,29000,30000,31000,32000,33000,34000,35000,36000,37000,38000,39000,40000,41000,42000,44000,45000,46000,47000,48000,49000,50000,51000,53000,54000,55000,56000&7036=-1&7001=62&7002=6&7090=70&7007=-1&7093=levels")
pce_raw <- url_pce %>%
html_nodes("table") %>%
.[2] %>%
html_table(fill = TRUE) %>%
.[[1]]
pci_clean <- pci_raw %>%
apply(2, function(x) gsub("[[:punct:]]", "", x)) %>%
as_tibble(.) %>%
group_by(GeoFips, GeoName) %>%
mutate_each(funs(as.numeric)) %>%
ungroup() %>%
select(Fips = GeoFips, Location = GeoName, `1997`:`2014`) %>%
gather(Year, Income, -c(Fips, Location))
pce_clean <- pce_raw %>%
apply(2, function(x) gsub("[[:punct:]]", "", x)) %>%
as_tibble(.) %>%
group_by(Fips, Area) %>%
mutate_each(funs(as.numeric)) %>%
ungroup() %>%
rename(Location = Area) %>%
gather(Year, Expenditures, -c(Fips, Location))
data_clean <- pci_clean %>%
left_join(pce_clean) %>%
mutate(Savings = Income - Expenditures,
Year = as.numeric(Year)) %>%
filter(Location != "District of Columbia")
rm(pce_clean, pce_raw, pci_clean, pci_raw, url_pce, url_pci)
data_clean
data_clean %>%
filter(Location == "United States") %>%
ggplot(aes(x = Year)) +
geom_line(aes(y = Income, group = 1), color = "darkseagreen4") +
geom_line(aes(y = Expenditures, group = 1), color = "firebrick3") +
geom_ribbon(aes(ymin = Expenditures, ymax = Income, group = 1), fill = "darkseagreen1", alpha = .5) +
annotate("text", x = 2014.25, y = 40471, label = "2014 PCI: $40.5K", color = "darkseagreen4", hjust = 0) +
annotate("text", x = 2014.25, y = 37196, label = "2014 PCE: $37.2K", color = "firebrick3", hjust = 0) +
annotate("text", x = 2014.25, y = 38833.5, label = "2014 Savings: $3.3K", color = "darkseagreen2", hjust = 0) +
scale_x_continuous(NULL, limits = c(1997, 2016), breaks = seq(1998, 2014, by = 4)) +
scale_y_continuous("Current Year Dollars", labels = scales::dollar) +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
mutate(Savings_Rate = Savings / Income) %>%
ggplot(aes(Year, Savings_Rate)) +
geom_line() +
geom_hline(aes(yintercept = mean(Savings_Rate)), linetype = "dashed", alpha = .5) +
scale_y_continuous(NULL, labels = scales::percent, limits = c(0, .115)) +
ggtitle("National-level Savings Rate") +
theme_minimal()
data_clean %>%
filter(Location == "United States") %>%
mutate(PCI_YoY = (Income - Income[1]) / Income[1],
PCE_YoY = (Expenditures - Expenditures[1]) / Expenditures[1],
Sav_YoY = (Savings - Savings[1]) / Savings[1]) %>%
select(Year, contains("YoY")) %>%
gather(Variable, Change, - Year) %>%
ggplot(aes(Year, Change, color = Variable)) +
geom_line()
library(leaflet)
leaflet()
leaflet(data_clean)
leaflet(data_clean) %>% addTiles()
leaflet(data_clean) %>%
addTiles() %>%
addPolygons((fillColor = topo.colors(10, alpha = NULL), stroke = FALSE))
leaflet(data_clean) %>%
addTiles() %>%
addPolygons(fillColor = topo.colors(10, alpha = NULL), stroke = FALSE)
install.packages("maps")
library(maps)
map_data("state")
data_clean
geom_map(data = data_clean, map = us$map, aes(map_id = Fips, fill = Savings))
install.packages("choroplethr")
library(choroplethr)
?state_choropleth
?StateChoropleth
data_clean
data_clean %>%
rename(Location = region, Savings = value) %>%
state_choropleth()
data_clean %>%
rename(Location = "region", Savings = "value") %>%
state_choropleth()
?rename
data_clean %>%
rename(Location = region, Savings = value)
detach("package:dplyr", unload=TRUE)
library("dplyr", lib.loc="/Library/Frameworks/R.framework/Versions/3.3/Resources/library")
data_clean %>%
rename(Location = region, Savings = value) %>%
state_choropleth()
data_clean %>%
rename(Location = region, Savings = value)
data_clean
rename(data_clean, Location = region)
rename(data_clean, Location = "region")
