url_pce <- read_html("http://www.bea.gov/iTable/iTableHtml.cfm?reqid=70&step=10&isuri=1&7003=2&7035=-1&7004=x&7005=1&7006=00000,01000,02000,04000,05000,06000,08000,09000,10000,11000,12000,13000,15000,16000,17000,18000,19000,20000,21000,22000,23000,24000,25000,26000,27000,28000,29000,30000,31000,32000,33000,34000,35000,36000,37000,38000,39000,40000,41000,42000,44000,45000,46000,47000,48000,49000,50000,51000,53000,54000,55000,56000&7036=-1&7001=62&7002=6&7090=70&7007=-1&7093=levels")
pce_raw <- url_pce %>%
html_nodes("table") %>%
.[2] %>%
html_table(fill = TRUE) %>%
.[[1]]
pci_clean <- pci_raw %>%
apply(2, function(x) gsub("[[:punct:]]", "", x)) %>%
as_tibble(.) %>%
group_by(GeoFips, GeoName) %>%
mutate_each(funs(as.numeric)) %>%
ungroup() %>%
select(Fips = GeoFips, Location = GeoName, `1997`:`2014`) %>%
gather(Year, Income, -c(Fips, Location))
pce_clean <- pce_raw %>%
apply(2, function(x) gsub("[[:punct:]]", "", x)) %>%
as_tibble(.) %>%
group_by(Fips, Area) %>%
mutate_each(funs(as.numeric)) %>%
ungroup() %>%
rename(Location = Area) %>%
gather(Year, Expenditures, -c(Fips, Location))
data_clean <- pci_clean %>%
left_join(pce_clean) %>%
mutate(Savings = Income - Expenditures,
Year = as.numeric(Year)) %>%
filter(Location != "District of Columbia")
rm(pce_clean, pce_raw, pci_clean, pci_raw, url_pce, url_pci)
data_clean
data_clean %>%
rename(Location = region, Savings = value)
?rename
rename(iris, petal_length = Petal.Length)
rename(data_clean, Location = region)
rename(data_clean, Location = test)
rename(data_clean, Location = 'test')
data_clean %>%
select(Location = region, Savings = value) %>%
state_choropleth()
data_clean %>%
select(Location = region, Savings = value)
library(dplyr)
clean_data
data_clean
data_clean %>% select(Location)
library(choroplethr)
data_clean %>%
select(region = Location, value = Savings) %>%
state_choropleth()
install.packages("choroplethrMaps")
library(choroplethr)
data_clean %>%
select(region = Location, value = Savings) %>%
state_choropleth()
data_clean %>%
select(region = Location, value = Savings)
data_clean %>%
select(region = tolower(Location), value = Savings) %>%
state_choropleth()
data_clean %>%
select(region = tolower(Location), value = Savings)
data_clean %>%
select(region = Location, value = Savings) %>%
mutate(region = tolower(region)) %>%
state_choropleth()
data_clean %>%
select(region = Location, value = Savings) %>%
mutate(region = tolower(region))
data_clean
data_clean %>%
filter(Year == 2014) %>%
select(region = Location, value = Savings) %>%
mutate(region = tolower(region)) %>%
state_choropleth()
data_clean %>%
filter(Year == 2014) %>%
mutate(region = tolower(Location),
value = Savings / Income) %>%
state_choropleth()
data_clean %>%
filter(Year == 2014) %>%
mutate(region = tolower(Location),
value = round(Savings / Income) * 100) %>%
state_choropleth()
data_clean %>%
filter(Year == 2014) %>%
mutate(region = tolower(Location),
value = round(Savings / Income, 1) * 100) %>%
state_choropleth()
data_clean %>%
filter(Year == 2014) %>%
mutate(region = tolower(Location),
value = round(Savings / Income, 1)) %>%
state_choropleth()
data_clean %>%
filter(Year == 2014) %>%
mutate(region = tolower(Location),
value = round(Savings / Income, 2)) %>%
state_choropleth()
data_clean %>%
filter(Year == 2014) %>%
mutate(region = tolower(Location),
value = round(Savings / Income, 2) * 100) %>%
state_choropleth()
maps::map_data("state")
map_data("state")
data_clean %>%
mutate(region = tolower(Location))
data_clean %>%
mutate(region = tolower(Location)) %>%
right_join(map_data("state"))
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
expand_limits() +
theme_void()
data_clean
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state"))
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state"))
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>% select(-subregion)
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>% select(-subregion) %>% na.omit()
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
na.omit() %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
expand_limits() +
theme_void()
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
expand_limits() +
theme_void()
?scale_fill_continuous
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
scale_color_gradient(low = "white", high = "black", name="Savings Rate") +
expand_limits() +
theme_void()
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(color = Savings_Rate)) +
facet_wrap(~ Year) +
scale_color_gradient(low = "white", high = "black", name="Savings Rate") +
expand_limits() +
theme_void()
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
scale_fill_gradient(low = "white", high = "black", name="Savings Rate") +
expand_limits() +
theme_void()
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
scale_fill_gradient(low = "white", high = "#3182bd", name="Savings Rate") +
expand_limits() +
theme_void()
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
scale_fill_gradient(low = "white", high = "#2c7fb8", name="Savings Rate") +
expand_limits() +
theme_void()
library(plotly)
p <- data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
scale_fill_gradient(low = "white", high = "#2c7fb8", name="Savings Rate") +
expand_limits() +
theme_void()
ggplotly(p)
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
scale_fill_gradient(low = "white", high = "#2d004b", name="Savings Rate") +
expand_limits() +
theme_void()
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
scale_fill_gradient(low = "white", high = "#313695", name="Savings Rate") +
expand_limits() +
theme_void()
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
scale_fill_gradient(low = "white", high = "darkblue", name="Savings Rate") +
expand_limits() +
theme_void()
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
scale_fill_gradient(low = "white", high = "dodgerblue4", name="Savings Rate") +
expand_limits() +
theme_void()
?scale_fill_gradient
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
scale_fill_gradient2(name="Savings Rate") +
expand_limits() +
theme_void()
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
scale_fill_gradient2(name="Savings Rate") +
expand_limits()
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
scale_fill_gradient2(name="Savings Rate", labels = percent) +
expand_limits() +
theme_void()
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
scale_fill_gradient2(name="Savings Rate", labels = scales::percent) +
expand_limits() +
theme_void()
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
scale_fill_gradient2(name="Savings Rate", labels = scales::percent) +
expand_limits() +
theme_void() +
theme(strip.text.x = element_text(size = 8))
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year) +
scale_fill_gradient2(name="Savings Rate", labels = scales::percent) +
expand_limits() +
theme_void() +
theme(strip.text.x = element_text(size = 12))
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 2)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year, ncol = 3) +
scale_fill_gradient2(name="Savings Rate", labels = scales::percent) +
expand_limits() +
theme_void() +
theme(strip.text.x = element_text(size = 12))
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 3)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year, ncol = 3) +
scale_fill_gradient2(name="Savings Rate", labels = scales::percent) +
expand_limits() +
theme_void() +
theme(strip.text.x = element_text(size = 12))
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 2)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year, ncol = 3) +
scale_fill_gradient2(name="Savings Rate", labels = scales::percent) +
expand_limits() +
theme_void() +
theme(strip.text.x = element_text(size = 12))
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 2)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year, ncol = 3) +
scale_fill_gradient2(name="Savings Rate", labels = scales::percent) +
expand_limits() +
theme_void() +
theme(strip.text.x = element_text(size = 12),
text = element_text(family = "Georgia"))
?labs
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 2)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year, ncol = 3) +
scale_fill_gradient2(name="Savings Rate", labels = scales::percent) +
labs("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1998-2014)") +
expand_limits() +
theme_void() +
theme(strip.text.x = element_text(size = 12),
text = element_text(family = "Georgia"))
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 2)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year, ncol = 3) +
scale_fill_gradient2(name="Savings Rate", labels = scales::percent) +
labs("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1998-2014)") +
#expand_limits() +
theme_void() +
theme(strip.text.x = element_text(size = 12),
text = element_text(family = "Georgia"))
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 2)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year, ncol = 3) +
scale_fill_gradient2(name="Savings Rate", labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1998-2014)") +
#expand_limits() +
theme_void() +
theme(strip.text.x = element_text(size = 12),
text = element_text(family = "Georgia"))
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 2)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year, ncol = 3) +
scale_fill_gradient2(name="Savings Rate", labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1998-2014)") +
#expand_limits() +
theme_void() +
theme(strip.text.x = element_text(size = 12),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 20, margin = margin(b = 10)),
plot.subtitle = element_text(size = 10, color = "darkslategrey", margin = margin(b = 25)),)
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 2)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year, ncol = 3) +
scale_fill_gradient2(name="Savings Rate", labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1998-2014)") +
#expand_limits() +
theme_void() +
theme(strip.text.x = element_text(size = 12),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 20, margin = margin(b = 10)),
plot.subtitle = element_text(size = 10, color = "darkslategrey", margin = margin(b = 25)))
data_clean %>%
mutate(region = tolower(Location),
Savings_Rate = Savings / Income) %>%
right_join(map_data("state")) %>%
select(-subregion) %>%
filter(Year %in% seq(1998, 2014, by = 2)) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Savings_Rate)) +
facet_wrap(~ Year, ncol = 3) +
scale_fill_gradient2(name="Savings Rate", labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1998-2014)") +
expand_limits() +
theme_void() +
theme(strip.text.x = element_text(size = 12),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 28, margin = margin(b = 10)),
plot.subtitle = element_text(size = 12, color = "darkslategrey", margin = margin(b = 25)))
