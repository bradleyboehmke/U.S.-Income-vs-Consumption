library(readr)
library(tidyr)
library(dplyr)
library(ggplot2)
pce <- read_csv("state per capita expenditures.csv")
pci <- read_csv("state per capita income.csv")
pce_us <- pce %>%
filter(Description == "Personal consumption expenditures",
GeoName == "United States") %>%
gather(Year, Expenditures, `1997`:`2014`) %>%
select(Year, Expenditures)
pci_us <- pci %>%
filter(Description == "Per capita personal income (dollars) 2/",
GeoName == "United States") %>%
gather(Year, Income, `1997`:`2015`) %>%
select(Year, Income)
savings_us <- pce_us %>%
left_join(pci_us) %>%
mutate(Savings = Income - Expenditures,
Savings_Rate = Savings / Income)
ggplot(savings_us, aes(Year, Savings_Rate, group = 1)) +
geom_line() +
scale_y_continuous(labels = scales::percent, limits = c(0, .23))
pce_state <- pce %>%
slice(25:1248) %>%
filter(Description == "Personal consumption expenditures") %>%
gather(Year, Expenditures, `1997`:`2014`) %>%
select(GeoName, Year, Expenditures)
pci_state <- pci %>%
slice(4:156) %>%
filter(Description == "Per capita personal income (dollars) 2/") %>%
gather(Year, Income, `1997`:`2014`) %>%
select(GeoName, Year, Income)
savings_state <- pce_state %>%
left_join(pci_state) %>%
mutate(Savings = Income - Expenditures,
Savings_Rate = Savings / Income,
Year = as.numeric(Year)) %>%
filter(GeoName != "District of Columbia")
savings_state %>%
filter(Year == 2014) %>%
arrange(desc(Savings_Rate))
savings_state %>%
filter(Year == 2014) %>%
arrange(Savings_Rate)
savings_state %>%
filter(Year == 2014) %>%
arrange(desc(Savings_Rate))
savings_state %>%
group_by(GeoName) %>%
summarise(Avg_Rate = mean(Savings_Rate)) %>%
arrange(desc(Avg_Rate))
savings_state <- savings_state %>%
group_by(GeoName) %>%
slice(c(1, 18)) %>%
select(GeoName, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Change = ifelse(`1997` < `2014`, "Positive", "Negative")) %>%
select(GeoName, Change) %>%
right_join(savings_state)
ggplot(savings_state, aes(Year, Savings_Rate)) +
geom_line(aes(group = GeoName, color = Change)) +
facet_wrap(~ GeoName, ncol = 5) +
scale_x_continuous(breaks = c(1997, 2014)) +
scale_y_continuous(labels = scales::percent, breaks = c(0, .3)) +
xlab(NULL) +
ylab(NULL) +
theme_bw()
savings_state %>%
group_by(GeoName) %>%
slice(c(1, 18)) %>%
select(GeoName, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Diff = `2014` - `1997`,
Change = ifelse(`1997` < `2014`, "Positive", "Negative")) %>%
arrange(Diff)
savings_state %>%
group_by(GeoName) %>%
slice(c(1, 18)) %>%
select(GeoName, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Diff = `2014` - `1997`,
Change = ifelse(`1997` < `2014`, "Positive", "Negative")) %>%
arrange(Diff) %>% count(Change)
savings_state %>%
group_by(GeoName) %>%
slice(c(1, 18)) %>%
select(GeoName, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Diff = `2014` - `1997`,
Change = ifelse(`1997` < `2014`, "Positive", "Negative")) %>%
arrange(Diff) %>% summary(Change)
savings_state %>%
group_by(GeoName) %>%
slice(c(1, 18)) %>%
select(GeoName, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Diff = `2014` - `1997`,
Change = ifelse(`1997` < `2014`, "Positive", "Negative")) %>%
arrange(Diff) %>% summary(factor(Change))
savings_state %>%
group_by(GeoName) %>%
slice(c(1, 18)) %>%
select(GeoName, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Diff = `2014` - `1997`,
Change = ifelse(`1997` < `2014`, "Positive", "Negative")) %>%
arrange(Diff) %>% summary(.$factor(Change))
savings_state %>%
group_by(GeoName) %>%
slice(c(1, 18)) %>%
select(GeoName, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Diff = `2014` - `1997`,
Change = ifelse(`1997` < `2014`, "Positive", "Negative")) %>%
arrange(Diff) %>% .$Change
savings_state %>%
group_by(GeoName) %>%
slice(c(1, 18)) %>%
select(GeoName, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Diff = `2014` - `1997`,
Change = ifelse(`1997` < `2014`, "Positive", "Negative")) %>%
arrange(Diff) %>% .$Change %>% table()
savings_state %>%
group_by(GeoName) %>%
slice(c(1, 18))
savings_state
savings_state %>%
group_by(Change, Year)
ggplot(savings_state, aes(Year, Savings_Rate)) +
geom_boxplot() +
facet_wrap(~ Change, nrow = 2)
ggplot(savings_state, aes(Savings_Rate, Year)) +
geom_boxplot() +
facet_wrap(~ Change, nrow = 2)
ggplot(savings_state, aes(factor(Year), Savings_Rate)) +
geom_boxplot() +
facet_wrap(~ Change, nrow = 2)
ggplot(savings_state, aes(Savings_Rate)) +
geom_boxplot() +
facet_wrap(~ Change, nrow = 2)
ggplot(savings_state, aes(Savings_Rate, Change)) +
geom_boxplot()
ggplot(savings_state, aes(Change, Savings_Rate)) +
geom_boxplot()
ggplot(savings_state, aes(Savings_Rate)) +
geom_histogram()
t.test(Savings_Rate ~ Change, data = (savings_state)
t.test(Savings_Rate ~ Change, data = (savings_state)
t.test(Savings_Rate ~ Change, data = (savings_state))
wilcox.test(Savings_Rate ~ Change, data = (savings_state))
pce_state
pce
View(pce)
pce_state <- pce %>%
slice(1) %>%
gather(Year, Expenditures, `1997`:`2014`) %>%
select(GeoName, Year, Expenditures)
pce_us <- pce %>%
slice(1) %>%
gather(Year, Expenditures, `1997`:`2014`) %>%
select(GeoName, Year, Expenditures)
pce_us
pce_state <- pce %>%
slice(25:1248) %>%
filter(Description == "Personal consumption expenditures") %>%
gather(Year, Expenditures, `1997`:`2014`) %>%
select(GeoName, Year, Expenditures)
pce_state
pce_state %>%
left_join(pce_us, by = Year)
pce_us
pce_state %>%
left_join(pce_us, by = "Year")
pce_us <- pce %>%
slice(1) %>%
gather(Year, Expenditures, `1997`:`2014`) %>%
select(Year, US_Expenditures)
pce_us <- pce %>%
slice(1) %>%
gather(Year, US_Expenditures, `1997`:`2014`) %>%
select(Year, US_Expenditures)
pce_state %>%
left_join(pce_us, by = "Year")
savings_state <- savings_state %>%
group_by(GeoName) %>%
slice(c(1, 18)) %>%
select(GeoName, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Change = ifelse(`1997` < `2014`, "Positive", "Negative")) %>%
select(GeoName, Change) %>%
right_join(savings_state)
savings_state
savings_state %>%
left_join(pce_us, by = "Year") %>%
mutate()
str(pce_us)
str(savings_state)
pce_us <- pce %>%
slice(1) %>%
gather(Year, US_Expenditures, `1997`:`2014`) %>%
select(Year, US_Expenditures) %>%
mutate(Year = as.numeric(Year))
savings_state %>%
left_join(pce_us, by = "Year") %>%
mutate()
pci %>%
slice(1)
View(pci)
pci %>%
slice(1) %>%
gather(Year, US_Income, `1997`:`2014`) %>%
select(Year, US_Incomes)
pci %>%
slice(1) %>%
gather(Year, US_Income, `1997`:`2014`)
pci %>%
slice(3) %>%
gather(Year, US_Income, `1997`:`2014`) %>%
select(Year, US_Incomes)
pci %>%
slice(3) %>%
gather(Year, US_Income, `1997`:`2014`)
pci %>%
filter(Description == "Per capita personal income (dollars) 2/",
GeoName == "United States") %>%
gather(Year, Income, `1997`:`2015`)
pci %>%
filter(Description == "Per capita personal income (dollars) 2/",
GeoName == "United States") %>%
gather(Year, Income, `1997`:`2015`) %>%
select(Year, Income)
pci %>%
slice(3) %>%
gather(Year, US_Income, `1997`:`2014`) %>%
select(Year, US_Incomes)
pci %>%
slice(3) %>%
gather(Year, US_Income, `1997`:`2014`) %>%
select(Year, US_Income)
pci %>%
slice(3) %>%
gather(Year, US_Income, `1997`:`2014`) %>%
select(Year, US_Income) %>% str()
pci_us <- pci %>%
slice(3) %>%
gather(Year, US_Income, `1997`:`2014`) %>%
select(Year, US_Income) %>%
mutate(Year = as.numeric(Year))
savings_state %>%
left_join(pce_us, by = "Year") %>%
left_join(pci_us, by = "Year") %>%
mutate(Exp_Pct = )
savings_state %>%
left_join(pce_us, by = "Year") %>%
left_join(pci_us, by = "Year")
savings_state %>%
left_join(pce_us, by = "Year") %>%
left_join(pci_us, by = "Year") %>%
mutate(Exp_Pct = Expenditures / US_Expenditures,
Inc_Pct = Income / US_Income) %>%
select(-Expenditures:Savings_Rate)
savings_state %>%
left_join(pce_us, by = "Year") %>%
left_join(pci_us, by = "Year") %>%
mutate(Exp_Pct = Expenditures / US_Expenditures,
Inc_Pct = Income / US_Income) %>%
select(-c(Expenditures:Savings_Rate))
pcts <- savings_state %>%
left_join(pce_us, by = "Year") %>%
left_join(pci_us, by = "Year") %>%
mutate(Exp_Pct = Expenditures / US_Expenditures,
Inc_Pct = Income / US_Income) %>%
select(-c(Expenditures:Savings_Rate))
t.test(Exp_Pct ~ Change, data = pcts)
wilcox.test(Exp_Pct ~ Change, data = pcts)
t.test(EInc_Pct ~ Change, data = pcts)
t.test(Inc_Pct ~ Change, data = pcts)
ggplot(pcts, aes(Change, Exp_Pct)) +
geom_boxplot()
ggplot(pcts, aes(Change, Exp_Pct)) +
geom_boxplot() +
geom_jitter()
savings_state %>%
left_join(pce_us, by = "Year") %>%
left_join(pci_us, by = "Year") %>%
mutate(Exp_Pct = Expenditures / US_Expenditures,
Inc_Pct = Income / US_Income) %>%
select(-c(Expenditures:Savings_Rate))
library(rvest)        # scraping data
library(tidyr)        # creating tidy data
library(dplyr)        # transforming (joining, summarizing, etc.) data
library(tibble)       # coercing data to tibbles
library(magrittr)     # for piping capabilities
library(ggplot2)      # visualizing data
url_pci <- read_html("http://www.bea.gov/iTable/iTableHtml.cfm?reqid=70&step=30&isuri=1&7022=21&7023=0&7024=non-industry&7033=-1&7025=0&7026=00000,01000,02000,04000,05000,06000,08000,09000,10000,11000,12000,13000,15000,16000,17000,18000,19000,20000,21000,22000,23000,24000,25000,26000,27000,28000,29000,30000,31000,32000,33000,34000,35000,36000,37000,38000,39000,40000,41000,42000,44000,45000,46000,47000,48000,49000,50000,51000,53000,54000,55000,56000&7027=-1&7001=421&7028=53&7031=0&7040=-1&7083=levels&7029=23&7090=70")
pci_raw <- url_pci %>%
html_nodes("table") %>%
.[2] %>%
html_table(fill = TRUE) %>%
.[[1]]
url_pce <- read_html("http://www.bea.gov/iTable/iTableHtml.cfm?reqid=70&step=10&isuri=1&7003=2&7035=-1&7004=x&7005=1&7006=00000,01000,02000,04000,05000,06000,08000,09000,10000,11000,12000,13000,15000,16000,17000,18000,19000,20000,21000,22000,23000,24000,25000,26000,27000,28000,29000,30000,31000,32000,33000,34000,35000,36000,37000,38000,39000,40000,41000,42000,44000,45000,46000,47000,48000,49000,50000,51000,53000,54000,55000,56000&7036=-1&7001=62&7002=6&7090=70&7007=-1&7093=levels")
url_pce %>%
html_nodes("table")
url_pce %>%
html_nodes("table") %>%
.[2]
url_pce %>%
html_nodes("table") %>%
.[2] %>%
html_table(fill = TRUE) %>%
.[[1]]
pce_raw <- url_pce %>%
html_nodes("table") %>%
.[2] %>%
html_table(fill = TRUE) %>%
.[[1]]
pci_clean <- pci_raw %>%
apply(2, function(x) gsub("[[:punct:]]", "", x)) %>%
as_tibble(.) %>%
group_by(GeoFips, GeoName) %>%
mutate_each(funs(as.numeric)) %>%
ungroup()
pce_clean <- pce_raw %>%
apply(2, function(x) gsub("[[:punct:]]", "", x)) %>%
as_tibble(.) %>%
group_by(GeoFips, GeoName) %>%
mutate_each(funs(as.numeric)) %>%
ungroup()
pce_raw %>%
apply(2, function(x) gsub("[[:punct:]]", "", x)) %>%
as_tibble(.)
pce_clean <- pce_raw %>%
apply(2, function(x) gsub("[[:punct:]]", "", x)) %>%
as_tibble(.) %>%
group_by(Fips, Area) %>%
mutate_each(funs(as.numeric)) %>%
ungroup()
pci_clean
pci_clean <- pci_raw %>%
apply(2, function(x) gsub("[[:punct:]]", "", x)) %>%
as_tibble(.) %>%
group_by(GeoFips, GeoName) %>%
mutate_each(funs(as.numeric)) %>%
ungroup() %>%
select(Fips, Location = GeoName, `1997`:`2014`)
pci_clean <- pci_raw %>%
apply(2, function(x) gsub("[[:punct:]]", "", x)) %>%
as_tibble(.) %>%
group_by(GeoFips, GeoName) %>%
mutate_each(funs(as.numeric)) %>%
ungroup() %>%
select(Fips = GeoFips, Location = GeoName, `1997`:`2014`)
pce_clean
pce_clean <- pce_raw %>%
apply(2, function(x) gsub("[[:punct:]]", "", x)) %>%
as_tibble(.) %>%
group_by(Fips, Area) %>%
mutate_each(funs(as.numeric)) %>%
ungroup() %>%
rename(Location = Area)
pci_clean
pce_clean
