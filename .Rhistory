select(Location, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Change = `2014` - `1997`) %>%
arrange(desc(abs(Change))) %>%
mutate(`1997` = paste0(round(`1997` * 100, 3), "%"))
largest_change <- savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
select(Location, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Change = `2014` - `1997`) %>%
arrange(desc(abs(Change))) %>%
mutate(`1997` = paste0(round(`1997` * 100, 3), "%"))
knitr::kable(largest_change, caption = 'States with the largest savings rate change since 1997')
largest_change <- savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
select(Location, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Change = `2014` - `1997`) %>%
arrange(desc(abs(Change))) %>%
mutate(`1997` = paste0(round(`1997` * 100, 1), "%"))
knitr::kable(largest_change, caption = 'States with the largest savings rate change since 1997')
largest_change <- savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
select(Location, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Change = `2014` - `1997`) %>%
arrange(desc(abs(Change))) %>%
mutate(`1997` = paste0(round(`1997` * 100, 1), "%"),
`2014` = paste0(round(`2014` * 100, 1), "%"),
Change = paste0(round(Change * 100, 1), "%"))
knitr::kable(largest_change, caption = 'States with the largest savings rate change since 1997')
largest_change <- savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
select(Location, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Change = `2014` - `1997`) %>%
arrange(desc(abs(Change))) %>%
mutate(`1997` = paste0(round(`1997` * 100, 1), "%"),
`2014` = paste0(round(`2014` * 100, 1), "%"),
Change = paste0(round(Change * 100, 1), "%")) %>%
slice(1:10)
knitr::kable(largest_change, caption = 'States with the largest savings rate change since 1997')
largest_change <- savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
select(Location, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Change = `2014` - `1997`) %>%
arrange(desc(abs(Change))) %>%
mutate(`1997` = paste0(round(`1997` * 100, 1), "%"),
`2014` = paste0(round(`2014` * 100, 1), "%"),
Change = paste0(round(Change * 100, 1), "%")) %>%
slice(1:15)
knitr::kable(largest_change, caption = 'States with the largest savings rate change since 1997')
largest_change <- savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
select(Location, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Change = `2014` - `1997`) %>%
arrange(desc(abs(Change))) %>%
mutate(`1997` = paste0(round(`1997` * 100, 1), "%"),
`2014` = paste0(round(`2014` * 100, 1), "%"),
Change = paste0(round(Change * 100, 1), "%")) %>%
slice(1:10)
knitr::kable(largest_change, caption = 'States with the largest savings rate change since 1997')
largest_change <- savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
select(Location, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Change = `2014` - `1997`) %>%
arrange(desc(abs(Change))) %>%
mutate(`1997` = paste0(round(`1997` * 100, 1), "%"),
`2014` = paste0(round(`2014` * 100, 1), "%"),
Change = paste0(round(Change * 100, 1), "%")) %>%
slice(1:10)
knitr::kable(largest_change, caption = 'Table 2: States with the largest savings rate change since 1997',
align = c(l, r, r, r))
largest_change <- savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
select(Location, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Change = `2014` - `1997`) %>%
arrange(desc(abs(Change))) %>%
mutate(`1997` = paste0(round(`1997` * 100, 1), "%"),
`2014` = paste0(round(`2014` * 100, 1), "%"),
Change = paste0(round(Change * 100, 1), "%")) %>%
slice(1:10)
knitr::kable(largest_change, caption = 'Table 2: States with the largest savings rate change since 1997',
align = c('l', 'r', 'r', 'r'))
library(rvest)        # scraping data
library(tidyr)        # creating tidy data
library(dplyr)        # transforming (joining, summarizing, etc.) data
library(tibble)       # coercing data to tibbles
library(magrittr)     # for piping capabilities
library(DT)           # for printing nice HTML output tables
library(ggplot2)
url_pci <- read_html("http://www.bea.gov/iTable/iTableHtml.cfm?reqid=70&step=30&isuri=1&7022=21&7023=0&7024=non-industry&7033=-1&7025=0&7026=00000,01000,02000,04000,05000,06000,08000,09000,10000,11000,12000,13000,15000,16000,17000,18000,19000,20000,21000,22000,23000,24000,25000,26000,27000,28000,29000,30000,31000,32000,33000,34000,35000,36000,37000,38000,39000,40000,41000,42000,44000,45000,46000,47000,48000,49000,50000,51000,53000,54000,55000,56000&7027=-1&7001=421&7028=53&7031=0&7040=-1&7083=levels&7029=23&7090=70")
# download PCI table and extract the data frame from the list
pci_raw <- url_pci %>%
html_nodes("table") %>%
.[2] %>%
html_table(fill = TRUE) %>%
.[[1]]
url_pce <- read_html("http://www.bea.gov/iTable/iTableHtml.cfm?reqid=70&step=10&isuri=1&7003=2&7035=-1&7004=x&7005=1&7006=00000,01000,02000,04000,05000,06000,08000,09000,10000,11000,12000,13000,15000,16000,17000,18000,19000,20000,21000,22000,23000,24000,25000,26000,27000,28000,29000,30000,31000,32000,33000,34000,35000,36000,37000,38000,39000,40000,41000,42000,44000,45000,46000,47000,48000,49000,50000,51000,53000,54000,55000,56000&7036=-1&7001=62&7002=6&7090=70&7007=-1&7093=levels")
# download PCE table and extract the data frame from the list
pce_raw <- url_pce %>%
html_nodes("table") %>%
.[2] %>%
html_table(fill = TRUE) %>%
.[[1]]
pci_clean <- pci_raw %>%
apply(2, function(x) gsub("[[:punct:]]", "", x)) %>%
as_tibble(.) %>%
group_by(GeoFips, GeoName) %>%
mutate_each(funs(as.numeric)) %>%
ungroup() %>%
select(Fips = GeoFips, Location = GeoName, `1997`:`2014`) %>%
gather(Year, Income, -c(Fips, Location))
# create tidy PCE data
pce_clean <- pce_raw %>%
apply(2, function(x) gsub("[[:punct:]]", "", x)) %>%
as_tibble(.) %>%
group_by(Fips, Area) %>%
mutate_each(funs(as.numeric)) %>%
ungroup() %>%
rename(Location = Area) %>%
gather(Year, Expenditures, -c(Fips, Location))
# create tidy merged data frame
data_clean <- pci_clean %>%
left_join(pce_clean) %>%
mutate(Savings = Income - Expenditures,
Year = as.numeric(Year)) %>%
filter(Location != "District of Columbia")
rm(pce_clean, pce_raw, pci_clean, pci_raw, url_pce, url_pci)
data_clean %>% filter(Year == 1998)
data_clean %>% filter(Year == 1998) %>% range()
savings_rate <- data_clean %>%
mutate(Savings_Rate = Savings / Income) %>%
filter(Year == 2014, Location != "United States") %>%
arrange(desc(Savings_Rate))
savings_rate
savings_rate %>% filter(Year == 1997)
savings_rate %>% filter(Year == 1998)
savings_rate <- data_clean %>%
mutate(Savings_Rate = Savings / Income) %>%
filter(Location != "United States") %>%
arrange(desc(Savings_Rate))
savings_rate %>% filter(Year == 1997)
savings_rate %>% filter(Year == 1997) %>% range(.$Savings_Rate)
?range
savings_rate %>% filter(Year == 1997) %>% range(.[[Savings_Rate]])
savings_rate %>% filter(Year == 1997) %>% .[[Savings_Rate]]
savings_rate %>% filter(Year == 1997) %>% .$Savings_Rate
savings_rate %>% filter(Year == 1997) %>% .$Savings_Rate %>% range()
savings_rate %>% filter(Year == 2014) %>% .$Savings_Rate %>% range()
savings_rate %>% filter(Year == 1997) %>% .$Savings_Rate %>% summary()
savings_rate %>% filter(Year == 2014) %>% .$Savings_Rate %>% summary()
ggplot(savings_rate, aes(Year, Savings_Rate, group = Location)) +
geom_line(alpha = .1) +
geom_line(data = filter(savings_rate, Location %in% top5$Location),
aes(Year, Savings_Rate, group = Location), color = "dodgerblue") +
geom_line(data = filter(savings_rate, Location %in% bottom5$Location),
aes(Year, Savings_Rate, group = Location), color = "red") +
geom_point(data = top5, aes(Year, Savings_Rate), color = "dodgerblue") +
geom_text(data = top5, aes(label = Location), hjust = 0, nudge_x = 0.2, size = 3) +
geom_point(data = bottom5, aes(Year, Savings_Rate), color = "red") +
geom_text(data = bottom5, aes(label = Location), hjust = 0, nudge_x = 0.2, size = 3) +
scale_x_continuous(NULL, limits = c(1997, 2015.25), breaks = seq(1998, 2014, by = 2)) +
scale_y_continuous(NULL, labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1997-2014)") +
theme_minimal() +
theme(panel.grid.minor = element_blank(),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 28, margin = margin(b = 10)),
plot.subtitle = element_text(size = 12, color = "darkslategrey", margin = margin(b = 25)))
savings_rate <- data_clean %>%
mutate(Savings_Rate = Savings / Income) %>%
filter(Location != "United States")
top5 <- savings_rate %>%
arrange(desc(Savings_Rate)) %>%
filter(Year == 2014) %>%
slice(1:5)
bottom5 <- savings_rate %>%
arrange(Savings_Rate) %>%
filter(Year == 2014) %>%
slice(1:5)
ggplot(savings_rate, aes(Year, Savings_Rate, group = Location)) +
geom_line(alpha = .1) +
geom_line(data = filter(savings_rate, Location %in% top5$Location),
aes(Year, Savings_Rate, group = Location), color = "dodgerblue") +
geom_line(data = filter(savings_rate, Location %in% bottom5$Location),
aes(Year, Savings_Rate, group = Location), color = "red") +
geom_point(data = top5, aes(Year, Savings_Rate), color = "dodgerblue") +
geom_text(data = top5, aes(label = Location), hjust = 0, nudge_x = 0.2, size = 3) +
geom_point(data = bottom5, aes(Year, Savings_Rate), color = "red") +
geom_text(data = bottom5, aes(label = Location), hjust = 0, nudge_x = 0.2, size = 3) +
scale_x_continuous(NULL, limits = c(1997, 2015.25), breaks = seq(1998, 2014, by = 2)) +
scale_y_continuous(NULL, labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1997-2014)") +
theme_minimal() +
theme(panel.grid.minor = element_blank(),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 28, margin = margin(b = 10)),
plot.subtitle = element_text(size = 12, color = "darkslategrey", margin = margin(b = 25)))
?geom_text_repel
install.packages("ggrepel")
library(ggrepel)
ggplot(savings_rate, aes(Year, Savings_Rate, group = Location)) +
geom_line(alpha = .1) +
geom_line(data = filter(savings_rate, Location %in% top5$Location),
aes(Year, Savings_Rate, group = Location), color = "dodgerblue") +
geom_line(data = filter(savings_rate, Location %in% bottom5$Location),
aes(Year, Savings_Rate, group = Location), color = "red") +
geom_point(data = top5, aes(Year, Savings_Rate), color = "dodgerblue") +
geom_text_repel(data = top5, aes(label = Location), hjust = 0, nudge_x = 0.2, size = 3) +
geom_point(data = bottom5, aes(Year, Savings_Rate), color = "red") +
geom_text(data = bottom5, aes(label = Location), hjust = 0, nudge_x = 0.2, size = 3) +
scale_x_continuous(NULL, limits = c(1997, 2015.25), breaks = seq(1998, 2014, by = 2)) +
scale_y_continuous(NULL, labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1997-2014)") +
theme_minimal() +
theme(panel.grid.minor = element_blank(),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 28, margin = margin(b = 10)),
plot.subtitle = element_text(size = 12, color = "darkslategrey", margin = margin(b = 25)))
?geom_text_repel
ggplot(savings_rate, aes(Year, Savings_Rate, group = Location)) +
geom_line(alpha = .1) +
geom_line(data = filter(savings_rate, Location %in% top5$Location),
aes(Year, Savings_Rate, group = Location), color = "dodgerblue") +
geom_line(data = filter(savings_rate, Location %in% bottom5$Location),
aes(Year, Savings_Rate, group = Location), color = "red") +
geom_point(data = top5, aes(Year, Savings_Rate), color = "dodgerblue") +
geom_text_repel(data = top5, aes(label = Location), nudge_x = 0.2, size = 3) +
geom_point(data = bottom5, aes(Year, Savings_Rate), color = "red") +
geom_text(data = bottom5, aes(label = Location), hjust = 0, nudge_x = 0.2, size = 3) +
scale_x_continuous(NULL, limits = c(1997, 2015.25), breaks = seq(1998, 2014, by = 2)) +
scale_y_continuous(NULL, labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1997-2014)") +
theme_minimal() +
theme(panel.grid.minor = element_blank(),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 28, margin = margin(b = 10)),
plot.subtitle = element_text(size = 12, color = "darkslategrey", margin = margin(b = 25)))
ggplot(savings_rate, aes(Year, Savings_Rate, group = Location)) +
geom_line(alpha = .1) +
geom_line(data = filter(savings_rate, Location %in% top5$Location),
aes(Year, Savings_Rate, group = Location), color = "dodgerblue") +
geom_line(data = filter(savings_rate, Location %in% bottom5$Location),
aes(Year, Savings_Rate, group = Location), color = "red") +
geom_point(data = top5, aes(Year, Savings_Rate), color = "dodgerblue") +
geom_text_repel(data = top5, aes(label = Location), nudge_x = 0.5, size = 3) +
geom_point(data = bottom5, aes(Year, Savings_Rate), color = "red") +
geom_text(data = bottom5, aes(label = Location), hjust = 0, nudge_x = 0.2, size = 3) +
scale_x_continuous(NULL, limits = c(1997, 2015.25), breaks = seq(1998, 2014, by = 2)) +
scale_y_continuous(NULL, labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1997-2014)") +
theme_minimal() +
theme(panel.grid.minor = element_blank(),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 28, margin = margin(b = 10)),
plot.subtitle = element_text(size = 12, color = "darkslategrey", margin = margin(b = 25)))
ggplot(savings_rate, aes(Year, Savings_Rate, group = Location)) +
geom_line(alpha = .1) +
geom_line(data = filter(savings_rate, Location %in% top5$Location),
aes(Year, Savings_Rate, group = Location), color = "dodgerblue") +
geom_line(data = filter(savings_rate, Location %in% bottom5$Location),
aes(Year, Savings_Rate, group = Location), color = "red") +
geom_point(data = top5, aes(Year, Savings_Rate), color = "dodgerblue") +
geom_text_repel(data = top5, aes(label = Location), nudge_x = 1, size = 3) +
geom_point(data = bottom5, aes(Year, Savings_Rate), color = "red") +
geom_text(data = bottom5, aes(label = Location), hjust = 0, nudge_x = 0.2, size = 3) +
scale_x_continuous(NULL, limits = c(1997, 2015.25), breaks = seq(1998, 2014, by = 2)) +
scale_y_continuous(NULL, labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1997-2014)") +
theme_minimal() +
theme(panel.grid.minor = element_blank(),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 28, margin = margin(b = 10)),
plot.subtitle = element_text(size = 12, color = "darkslategrey", margin = margin(b = 25)))
ggplot(savings_rate, aes(Year, Savings_Rate, group = Location)) +
geom_line(alpha = .1) +
geom_line(data = filter(savings_rate, Location %in% top5$Location),
aes(Year, Savings_Rate, group = Location), color = "dodgerblue") +
geom_line(data = filter(savings_rate, Location %in% bottom5$Location),
aes(Year, Savings_Rate, group = Location), color = "red") +
geom_point(data = top5, aes(Year, Savings_Rate), color = "dodgerblue") +
geom_text_repel(data = top5, aes(label = Location), nudge_x = .7, size = 3) +
geom_point(data = bottom5, aes(Year, Savings_Rate), color = "red") +
geom_text(data = bottom5, aes(label = Location), hjust = 0, nudge_x = 0.2, size = 3) +
scale_x_continuous(NULL, limits = c(1997, 2015.25), breaks = seq(1998, 2014, by = 2)) +
scale_y_continuous(NULL, labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1997-2014)") +
theme_minimal() +
theme(panel.grid.minor = element_blank(),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 28, margin = margin(b = 10)),
plot.subtitle = element_text(size = 12, color = "darkslategrey", margin = margin(b = 25)))
ggplot(savings_rate, aes(Year, Savings_Rate, group = Location)) +
geom_line(alpha = .1) +
geom_line(data = filter(savings_rate, Location %in% top5$Location),
aes(Year, Savings_Rate, group = Location), color = "dodgerblue") +
geom_line(data = filter(savings_rate, Location %in% bottom5$Location),
aes(Year, Savings_Rate, group = Location), color = "red") +
geom_point(data = top5, aes(Year, Savings_Rate), color = "dodgerblue") +
geom_text_repel(data = top5, aes(label = Location), nudge_x = .6, size = 3) +
geom_point(data = bottom5, aes(Year, Savings_Rate), color = "red") +
geom_text(data = bottom5, aes(label = Location), hjust = 0, nudge_x = 0.2, size = 3) +
scale_x_continuous(NULL, limits = c(1997, 2015.25), breaks = seq(1998, 2014, by = 2)) +
scale_y_continuous(NULL, labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1997-2014)") +
theme_minimal() +
theme(panel.grid.minor = element_blank(),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 28, margin = margin(b = 10)),
plot.subtitle = element_text(size = 12, color = "darkslategrey", margin = margin(b = 25)))
ggplot(savings_rate, aes(Year, Savings_Rate, group = Location)) +
geom_line(alpha = .1) +
geom_line(data = filter(savings_rate, Location %in% top5$Location),
aes(Year, Savings_Rate, group = Location), color = "dodgerblue") +
geom_line(data = filter(savings_rate, Location %in% bottom5$Location),
aes(Year, Savings_Rate, group = Location), color = "red") +
geom_point(data = top5, aes(Year, Savings_Rate), color = "dodgerblue") +
geom_text_repel(data = top5, aes(label = Location), nudge_x = .5, size = 3) +
geom_point(data = bottom5, aes(Year, Savings_Rate), color = "red") +
geom_text(data = bottom5, aes(label = Location), hjust = 0, nudge_x = 0.2, size = 3) +
scale_x_continuous(NULL, limits = c(1997, 2015.25), breaks = seq(1998, 2014, by = 2)) +
scale_y_continuous(NULL, labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1997-2014)") +
theme_minimal() +
theme(panel.grid.minor = element_blank(),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 28, margin = margin(b = 10)),
plot.subtitle = element_text(size = 12, color = "darkslategrey", margin = margin(b = 25)))
ggplot(savings_rate, aes(Year, Savings_Rate, group = Location)) +
geom_line(alpha = .1) +
geom_line(data = filter(savings_rate, Location %in% top5$Location),
aes(Year, Savings_Rate, group = Location), color = "dodgerblue") +
geom_line(data = filter(savings_rate, Location %in% bottom5$Location),
aes(Year, Savings_Rate, group = Location), color = "red") +
geom_point(data = top5, aes(Year, Savings_Rate), color = "dodgerblue") +
geom_text_repel(data = top5, aes(label = Location), nudge_x = .5, size = 3, hjust = 0) +
geom_point(data = bottom5, aes(Year, Savings_Rate), color = "red") +
geom_text(data = bottom5, aes(label = Location), hjust = 0, nudge_x = 0.2, size = 3) +
scale_x_continuous(NULL, limits = c(1997, 2015.25), breaks = seq(1998, 2014, by = 2)) +
scale_y_continuous(NULL, labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1997-2014)") +
theme_minimal() +
theme(panel.grid.minor = element_blank(),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 28, margin = margin(b = 10)),
plot.subtitle = element_text(size = 12, color = "darkslategrey", margin = margin(b = 25)))
ggplot(savings_rate, aes(Year, Savings_Rate, group = Location)) +
geom_line(alpha = .1) +
geom_line(data = filter(savings_rate, Location %in% top5$Location),
aes(Year, Savings_Rate, group = Location), color = "dodgerblue") +
geom_line(data = filter(savings_rate, Location %in% bottom5$Location),
aes(Year, Savings_Rate, group = Location), color = "red") +
geom_point(data = top5, aes(Year, Savings_Rate), color = "dodgerblue") +
geom_text_repel(data = top5, aes(label = Location), nudge_x = .5, size = 3) +
geom_point(data = bottom5, aes(Year, Savings_Rate), color = "red") +
geom_text_repel(data = bottom5, aes(label = Location), nudge_x = 0.5, size = 3) +
scale_x_continuous(NULL, limits = c(1997, 2015.25), breaks = seq(1998, 2014, by = 2)) +
scale_y_continuous(NULL, labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1997-2014)") +
theme_minimal() +
theme(panel.grid.minor = element_blank(),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 28, margin = margin(b = 10)),
plot.subtitle = element_text(size = 12, color = "darkslategrey", margin = margin(b = 25)))
ggplot(savings_rate, aes(Year, Savings_Rate, group = Location)) +
geom_line(alpha = .1) +
geom_line(data = filter(savings_rate, Location %in% top5$Location),
aes(Year, Savings_Rate, group = Location), color = "dodgerblue") +
geom_line(data = filter(savings_rate, Location %in% bottom5$Location),
aes(Year, Savings_Rate, group = Location), color = "red") +
geom_text_repel(data = top5, aes(label = Location), nudge_x = .5, size = 3) +
geom_point(data = top5, aes(Year, Savings_Rate), color = "dodgerblue") +
geom_point(data = bottom5, aes(Year, Savings_Rate), color = "red") +
geom_text_repel(data = bottom5, aes(label = Location), nudge_x = 0.5, size = 3) +
scale_x_continuous(NULL, limits = c(1997, 2015.25), breaks = seq(1998, 2014, by = 2)) +
scale_y_continuous(NULL, labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1997-2014)") +
theme_minimal() +
theme(panel.grid.minor = element_blank(),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 28, margin = margin(b = 10)),
plot.subtitle = element_text(size = 12, color = "darkslategrey", margin = margin(b = 25)))
ggplot(savings_rate, aes(Year, Savings_Rate, group = Location)) +
geom_line(alpha = .1) +
geom_line(data = filter(savings_rate, Location %in% top5$Location),
aes(Year, Savings_Rate, group = Location), color = "dodgerblue") +
geom_line(data = filter(savings_rate, Location %in% bottom5$Location),
aes(Year, Savings_Rate, group = Location), color = "red") +
geom_text_repel(data = top5, aes(label = Location), nudge_x = .5, size = 3) +
geom_point(data = top5, aes(Year, Savings_Rate), color = "dodgerblue") +
geom_text_repel(data = bottom5, aes(label = Location), nudge_x = 0.5, size = 3) +
geom_point(data = bottom5, aes(Year, Savings_Rate), color = "red") +
scale_x_continuous(NULL, limits = c(1997, 2015.25), breaks = seq(1998, 2014, by = 2)) +
scale_y_continuous(NULL, labels = scales::percent) +
ggtitle("Savings rate changes over time",
subtitle = "Temporal assessment of state-level savings rates (1997-2014)") +
theme_minimal() +
theme(panel.grid.minor = element_blank(),
text = element_text(family = "Georgia"),
plot.title = element_text(size = 28, margin = margin(b = 10)),
plot.subtitle = element_text(size = 12, color = "darkslategrey", margin = margin(b = 25)))
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
select(Location, Year, Savings_Rate) %>%
spread(Year, Savings_Rate) %>%
mutate(Change = `2014` - `1997`) %>%
arrange(desc(abs(Change)))
savings_rate
savings_rate %>%
filter(Year == 1997 | Year == 2014)
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
arrange(Location)
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
arrange(Location) %>%
select(Location, Year, Income, Expenditures)
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
arrange(Location) %>%
select(Location, Year, Income, Expenditures) %>%
spread(Year, Income:Expenditures)
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
select(Location, Year, Savings_Rate)
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
arrange(Location) %>%
select(Location, Year, Income, Expenditures) %>%
spread(Year, Income)
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
arrange(Location) %>%
select(Location, Year, Income, Expenditures) %>%
spread(Year, -Location)
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
arrange(Location) %>%
select(Location, Year, Income, Expenditures)
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
arrange(Location) %>%
select(Location, Year, Income, Expenditures) %>%
gather(Location) %>%
mutate(Income_Chg = (Income - lag(Income) / Income)
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
arrange(Location) %>%
select(Location, Year, Income, Expenditures) %>%
gather(Location) %>%
mutate(Income_Chg = (Income - lag(Income) / Income))
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
arrange(Location) %>%
select(Location, Year, Income, Expenditures) %>%
gather(Location) %>%
mutate(Income_Chg = (Income - lag(Income) / Income))
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
arrange(Location) %>%
select(Location, Year, Income, Expenditures) %>%
gather(Location)
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
arrange(Location) %>%
select(Location, Year, Income, Expenditures) %>%
group_by(Location) %>%
mutate(Income_Chg = (Income - lag(Income) / Income))
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
arrange(Location) %>%
select(Location, Year, Income, Expenditures) %>%
group_by(Location) %>%
mutate(Income_Chg = (Income - lag(Income) / lag(Income)))
33513-19050
(33513-19050) / 19050
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
arrange(Location) %>%
select(Location, Year, Income, Expenditures) %>%
group_by(Location) %>%
mutate(Inc_Chg = Income - lag(Income) / lag(Income),
Exp_Chg = Expenditures - lag(Expenditures) / lag(Expenditures))
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
arrange(Location) %>%
select(Location, Year, Income, Expenditures) %>%
group_by(Location)
savings_rate %>%
filter(Year == 1997 | Year == 2014) %>%
arrange(Location) %>%
select(Location, Year, Income, Expenditures) %>%
group_by(Location) %>%
mutate(Inc_Chg = Income - lag(Income) / lag(Income),
Exp_Chg = Expenditures - lag(Expenditures) / lag(Expenditures))
